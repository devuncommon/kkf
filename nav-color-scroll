<!-- Navbar Color Modes & Scroll Trigger -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const mediaQuery = window.matchMedia("(min-width: 992px)");

    function initNavColorMode() {
        const nav = document.querySelector(".nav"),
            firstThemeSection = document.querySelector("header[class*='theme']"),
            dropdownLinks = document.querySelectorAll(".nav-link[data-dropdown-link]"),
            navNote = document.querySelector(".nav-note"),
            dropdownCollections = document.querySelectorAll(".nav-dropdown_collection");

        let isScrolled = false,
            isDropdownOpen = false,
            isNavNoteHovered = false,
            timeoutId;

        function applyTheme() {
            if (!firstThemeSection || isScrolled || isDropdownOpen || isNavNoteHovered || isDropdownActive()) return;
            nav.classList.forEach((cls) => {
                if (cls.startsWith("theme")) nav.classList.remove(cls);
            });
            firstThemeSection.classList.forEach((cls) => {
                if (cls.startsWith("theme")) nav.classList.add(cls);
            });
        }

        function removeTheme(delayed = false) {
            clearTimeout(timeoutId);
            const reset = () => {
                nav.classList.forEach((cls) => {
                    if (cls.startsWith("theme")) nav.classList.remove(cls);
                });
            };
            if (delayed) {
                timeoutId = setTimeout(reset, 200);
            } else {
                reset();
            }
        }

        function isDropdownActive() {
            return document.querySelector(".nav-dropdown_collection.active") !== null;
        }

        function onDropdownEnter() {
            isDropdownOpen = true;
            removeTheme();
        }

        function onDropdownLeave() {
            isDropdownOpen = false;
            if (!isScrolled && !isDropdownOpen && !isNavNoteHovered && window.scrollY <= 0.9 * window.innerHeight) {
                applyTheme();
            }
        }

        function onNavNoteEnter() {
            isNavNoteHovered = true;
            removeTheme();
        }

        function onNavNoteLeave() {
            isNavNoteHovered = false;
            if (!isScrolled && !isDropdownOpen && !isNavNoteHovered && window.scrollY <= 0.9 * window.innerHeight) {
                applyTheme();
            }
        }

        function onScrollTrigger() {
            ScrollTrigger.matchMedia({
                "(min-width: 992px)": function () {
                    gsap.to(".nav_wrapper", {
                        scrollTrigger: {
                            trigger: ".main-wrapper",
                            start: "90vh top",
                            toggleClass: {
                                targets: [
                                    ".nav_wrapper",
                                    ".nav-note",
                                    ".nav-bg",
                                    ".nav-link",
                                    ".nav-menu_logo",
                                    ".nav-menu_cart-icon",
                                    ".nav-scroll-bg-bar",
                                    ".nav-dropdown_collection",
                                    ".nav-link_dropdown",
                                ],
                                className: "nav-scroll",
                            },
                            toggleActions: "play reverse play reverse",
                            markers: false,
                            onEnter: () => {
                                isScrolled = true;
                                removeTheme(true);
                            },
                            onLeaveBack: () => {
                                isScrolled = false;
                                if (!isDropdownOpen && !isNavNoteHovered && window.scrollY <= 0.9 * window.innerHeight) {
                                    applyTheme();
                                }
                            },
                        },
                    });
                },
            });
        }

        dropdownLinks.forEach((link) => {
            link.addEventListener("mouseenter", onDropdownEnter);
            link.addEventListener("mouseleave", onDropdownLeave);
        });

        if (navNote) {
            navNote.addEventListener("mouseenter", onNavNoteEnter);
            navNote.addEventListener("mouseleave", onNavNoteLeave);
        }

        dropdownCollections.forEach((collection) => {
            collection.addEventListener("mouseleave", () => {
                setTimeout(() => {
                    if (!isScrolled && !isDropdownOpen && !isNavNoteHovered) {
                        applyTheme();
                    }
                }, 50);
            });
        });

        if (window.scrollY <= 0.9 * window.innerHeight && !isDropdownActive()) {
            applyTheme();
        }

        onScrollTrigger();
    }

    if (mediaQuery.matches) {
        initNavColorMode();
    }

    mediaQuery.addEventListener("change", (event) => {
        if (event.matches) {
            initNavColorMode();
        } else {
            location.reload();
        }
    });
});
</script>
